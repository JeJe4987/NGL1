<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin - Messages</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container" id="content" style="display:none;">
    <h1>Pesan Masuk</h1>
    <div id="messages" class="message-list"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="firebase-config.js"></script>

  <script>
    const password = prompt('Masukkan password untuk mengakses halaman admin:');
    if (password === 'rahasia123') {
      document.getElementById('content').style.display = 'block';

      const messagesDiv = document.getElementById('messages');
      const messagesRef = database.ref('messages');

      messagesRef.on('child_added', (snapshot) => {
        const msg = snapshot.val();
        const key = snapshot.key;
        const messageItem = document.createElement('div');
        messageItem.classList.add('message-item');

        // Mark message as read if not already
        if (!msg.read) {
          messagesRef.child(key).update({ read: true });
        }

        const nameElem = document.createElement('div');
        nameElem.classList.add('message-name');
        nameElem.textContent = msg.name ? msg.name : 'Anonim';

        // Read/unread indicator
        const readIndicator = document.createElement('span');
        readIndicator.style.display = 'inline-block';
        readIndicator.style.width = '12px';
        readIndicator.style.height = '12px';
        readIndicator.style.borderRadius = '50%';
        readIndicator.style.marginLeft = '10px';
        readIndicator.style.backgroundColor = msg.read ? '#4caf50' : '#f44336'; // green if read, red if unread
        nameElem.appendChild(readIndicator);

        const textElem = document.createElement('div');
        textElem.classList.add('message-text');
        textElem.textContent = msg.message;

        // Delete button
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Hapus';
        deleteBtn.style.marginTop = '8px';
        deleteBtn.style.backgroundColor = '#f44336';
        deleteBtn.style.color = 'white';
        deleteBtn.style.border = 'none';
        deleteBtn.style.borderRadius = '8px';
        deleteBtn.style.padding = '4px 10px';
        deleteBtn.style.cursor = 'pointer';
        deleteBtn.style.float = 'right';
        deleteBtn.addEventListener('click', () => {
          if (confirm('Hapus pesan ini?')) {
            messagesRef.child(key).remove();
            messageItem.remove();
          }
        });

        messageItem.appendChild(nameElem);
        messageItem.appendChild(deleteBtn);
        messageItem.appendChild(textElem);

        messagesDiv.prepend(messageItem);

        // Add animation class for smooth appearance
        setTimeout(() => {
          messageItem.classList.add('show');
        }, 10);
      });
    } else {
      alert('Password salah. Anda tidak diizinkan mengakses halaman ini.');
      window.location.href = 'index.html';
    }
  </script>
</body>
</html>
